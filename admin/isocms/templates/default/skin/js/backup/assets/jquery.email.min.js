$().ready(function(){
	$('#clickQuickAddTeplateTag').click(function(){
		var _this = $(this);
		if($('#template_type').val()==''){
			alertify.error('Bạn chưa chọn mẫu E-Mail');
			$('#template_type').focus();
			return false;
		}
		var adata = {
			'type'	: $('#template_type').val()
		};
		$.ajax({
			type: "POST",
			url: path_ajax_script+"/index.php?mod="+mod+"&act=ajQuickAddTemplateTag",
			data: adata,
			dataType: "html",
			success: function(html){
				makepopup($(window).width()/3,'auto',html,'frmQuickAddTemplateTag');
			}
		});
		return false;
	});
	
	$('.clickToEditTemplateTag').live('click',function(){
		var _this = $(this);
		if($('#template_type').val()==''){
			alertify.error('Bạn chưa chọn mẫu E-Mail');
			$('#template_type').focus();
			return false;
		}
		var adata = {
			'template_email_id':_this.attr('data'),
			'type'	: $('#template_type').val()
		};
		$.ajax({
			type: "POST",
			url: path_ajax_script+"/index.php?mod="+mod+"&act=ajQuickEditTemplateTag",
			data: adata,
			dataType: "html",
			success: function(html){
				makepopup($(window).width()/3,'auto',html,'frmQuickEditTemplateTag');
			}
		});
		return false;
	});
	
	$('.clickToDeleteTemplateTag').live('click',function(){
		if(confirm(confim_delete)){
			var _this = $(this);
			var adata = {
				'template_email_id':_this.attr('data')
			};
			$.ajax({
				type: "POST",
				url: path_ajax_script+"/index.php?mod="+mod+"&act=ajQuickDeleteTemplateTag",
				data: adata,
				dataType: "html",
				success: function(html){
					var type = _this.attr('_type');
					getListTemplateTagsByType(type); 
				}
			});
		}
		return false;
	});
	
	$('#clickSubmitTemplateTag').live('click',function(){
		var _this = $(this);
		if($('#template_tag_title').val()==''){
			$('#template_tag_title').focus().addClass('error');
			return false;
		}
		if($('#template_tag_replace').val()==''){
			$('#template_tag_replace').focus().addClass('error');
			return false;
		}
		
		var adata={
			'title'	: $('#template_tag_title').val(),
			'replace_tag'	: $('#template_tag_replace').val(),
			'type'	: _this.attr('_type'),
			'template_tag_id': _this.attr('template_tag_id')
		};
		$.ajax({
			type: "POST",
			url: path_ajax_script+"/index.php?mod="+mod+"&act=ajSubmitTemplateTag",
			data: adata,
			dataType: "html",
			success: function(html){
				if(html='_SUCCESS'){
					$('.close_pop').click();
					var type = _this.attr('_type');
					getListTemplateTagsByType(type); 
				}else{
					alertify.error('Tag này đã tồn tại.');
				}
			}
		});
		return false;
	});
	
	// Get Tags
	$('#template_type').change(function(){
		var _this = $(this);
		getListTemplateTagsByType(_this.val()); 
	});
	
	// Load Tag
	getListTemplateTagsByType($('#template_type').val());
	
	// Add Tag to content
	$('.command').live('click',function(){
		var _this=$(this);
		insertYourContent(_this.attr('data'));
	});
});
function getListTemplateTagsByType(type){
	var adata={
		'type'	:type
	};
	$.ajax({
		type: "POST",
		url: path_ajax_script+"/index.php?mod="+mod+"&act=ajListTemplateTagsByType",
		data: adata,
		dataType: "html",
		success: function(html){
			$('#custom_template_tags').html(html);
		}
	});
}
function insertYourContent(text){
	tinyMCE.activeEditor.execCommand('mceInsertContent', false, text);
}